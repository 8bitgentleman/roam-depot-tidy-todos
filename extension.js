var r={100:(r,n,t)=>{t.d(n,{Z:()=>l});var e=t(81),o=t.n(e),a=t(645),i=t.n(a)()(o());i.push([r.id,'span.rm-page-ref[data-tag="tidy"], span.rm-page-ref[data-tag="tidy"] {\r\n  background: none;\r\n  border-radius: 10px;\r\n  padding: 1px 10px 1px 10px;\r\n  zoom: 80%;\r\n  color:#5c7080 !important;\r\n  border: 1px solid #5c7080 !important;\r\n  margin: 0 4px !important;\r\n}\r\n\r\n.tidyButton{\r\n  margin:0 6px 0 -4px !important\r\n}\r\n\r\n.tidyRemoveButton {\r\n  margin-left: -8px !important;\r\n  margin-top: -2px !important;\r\n}\r\n\r\n.tidyButton:hover, .tidyRemoveButton:hover{\r\n  background: transparent !important;\r\n}\r\n\r\n.tidyButton span, .tidyRemoveButton span {\r\n  padding-left: -2px !important;\r\n}\r\n\r\n.tidyButton svg, .tidyRemoveButton svg {\r\n  width: 14px !important;\r\n  height: 14px !important;\r\n  opacity: 0.8 !important;\r\n}',""]);const l=i},645:r=>{r.exports=function(r){var n=[];return n.toString=function(){return this.map((function(n){var t="",e=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),e&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=r(n),e&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(r,t,e,o,a){"string"==typeof r&&(r=[[null,r,void 0]]);var i={};if(e)for(var l=0;l<this.length;l++){var d=this[l][0];null!=d&&(i[d]=!0)}for(var c=0;c<r.length;c++){var s=[].concat(r[c]);e&&i[s[0]]||(void 0!==a&&(void 0===s[5]||(s[1]="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {").concat(s[1],"}")),s[5]=a),t&&(s[2]?(s[1]="@media ".concat(s[2]," {").concat(s[1],"}"),s[2]=t):s[2]=t),o&&(s[4]?(s[1]="@supports (".concat(s[4],") {").concat(s[1],"}"),s[4]=o):s[4]="".concat(o)),n.push(s))}},n}},81:r=>{r.exports=function(r){return r[1]}},186:r=>{r.exports='(ns tidy-todo-v8\r\n  (:require\r\n   [reagent.core :as r]\r\n   [roam.block :as block]\r\n   [datascript.core :as d]\r\n   [roam.datascript.reactive :as dr]\r\n   [clojure.string :as str]\r\n   [clojure.pprint :refer [pprint]]\r\n   [promesa.core :as p]\r\n   [roam.util :refer [parse]]\r\n   [blueprintjs.core :as bp]\r\n   [roam.datascript :as rd]\r\n   ))\r\n\r\n; THIS CODEBLOCK IS OVERWRITTEN ON EVERY VERSION UPDATE\r\n; DO NOT MODIFY\r\n\r\n(defonce bp-button (r/adapt-react-class bp/Button))\r\n\r\n(defn find-blocks-that-ref\r\n  "Returns all _refs for each children block given a parent block uid" \r\n  [block-uid ref-title]\r\n  (dr/q \'[:find (pull ?node [:block/order :block/string :block/uid])\r\n          :in $ ?uid ?ref-page-name\r\n          :where\r\n          [?e :block/uid ?uid]\r\n          [?e :block/children ?node]\r\n          [?node :block/refs ?DONE-Ref]\r\n          [?DONE-Ref :node/title ?ref-page-name]]\r\n    block-uid ref-title))\r\n\r\n(defn strip-markdown-syntax [string]\r\n  ;;strip out roam syntax so that sorting can happen on the actual letters\r\n  (-> string\r\n      (str/replace #"\\*\\*" "") ;;bold\r\n      (str/replace #"\\_\\_" "") ;;italic\r\n      (str/replace #"\\^\\^" "") ;;highlight\r\n      (str/replace #"\\#" "") ;;tag\r\n      (str/replace #"\\{\\{" "") ;;brackets\r\n      (str/replace #"\\}\\}" "") ;;brackets \r\n      (str/replace #"\\~\\~" "") ;;highlight\r\n      (str/replace #"\\]\\]" "") ;;roam pages \r\n      (str/replace #"\\[\\[" "") ;;roam pages\r\n    (str/replace #"\\[\\[[^]]+\\]\\([^)]+\\)" "$1");; markdown links\r\n    )\r\n  )\r\n\r\n(defn get-string [item]\r\n  (:block/string (first item)))\r\n\r\n(defn sort-by-string [data]\r\n  (sort-by #(str/lower-case (strip-markdown-syntax (get-string %))) data))\r\n\r\n(defn move-to-end [parent-uid item]\r\n  (block/move\r\n    {:location {:parent-uid parent-uid\r\n                :order "last"}\r\n     :block {:uid (:block/uid (first item))}}))\r\n\r\n(defn sorted-data [data]\r\n  (->> (deref data)\r\n       (sort-by #(get-in (first %) [:block/order]))\r\n  ))\r\n\r\n(defn sort-all-todos[parent-uid]\r\n  \r\n  (r/with-let [\r\n               TODOs (find-blocks-that-ref parent-uid "TODO")\r\n               DONEs (find-blocks-that-ref parent-uid "DONE")\r\n               ARCHIVEDs (find-blocks-that-ref parent-uid "ARCHIVED")\r\n              ]\r\n    (p/run!\r\n      (fn [item]\r\n        ;;(prn (first item))\r\n        (block/move\r\n          {:location {:parent-uid parent-uid\r\n                      :order "last"}\r\n           :block {:uid (:block/uid (first item))}}))\r\n      (concat\r\n        ;;sort TODOs by order not creation date\r\n        (sorted-data TODOs)\r\n        ;;sort alphabetically          \r\n        (sort-by-string @DONEs)\r\n        (sort-by-string @ARCHIVEDs)\r\n        )\r\n      )\r\n    )\r\n  )\r\n\r\n\r\n;; functions for removing the tidy\r\n(defn clean-tidy-string [input-string]\r\n  (let [pattern #"\\{\\{\\[\\[roam/render\\]\\]\\:.*?\\}\\}"\r\n        cleaned-string (clojure.string/replace input-string pattern "")]\r\n    cleaned-string))\r\n\r\n(defn get-block-string [uid]\r\n  (:block/string (rd/pull \r\n      \'[:block/string \r\n        ] \r\n      [:block/uid uid]))\r\n)\r\n\r\n(defn update-block-string\r\n  [block-uid block-string]\r\n  (block/update \r\n      {:block {:uid block-uid \r\n               :string block-string}})\r\n  )\r\n\r\n(defn remove-tidy [block-uid]\r\n  (->> block-uid\r\n    (get-block-string )\r\n    (clean-tidy-string)\r\n    (update-block-string block-uid)\r\n    )\r\n  )\r\n\r\n  (defn button [block-uid]\r\n    [bp-button \r\n        {:small true\r\n         :outlined false\r\n         :minimal true\r\n         :icon "sort"\r\n         :class "tidyButton"\r\n         :style{ :margin-right "4px"}\r\n         :title "Click to tidy this list"\r\n         :on-click (fn [e]\r\n                     (sort-all-todos block-uid))\r\n       }]\r\n)\r\n(defn delete-button [block-uid]\r\n    [bp-button \r\n        {:small true\r\n         :outlined false\r\n         :minimal true\r\n         :icon "small-cross"\r\n         :class "tidyRemoveButton"\r\n         :style{ :margin-right "4px"}\r\n         :title "Remove the tidy component"\r\n         :on-click (fn [e]\r\n                     (remove-tidy block-uid))\r\n       }]\r\n)\r\n\r\n(defn main [{:keys [block-uid]} & args]\r\n    [:div\r\n       (parse (str "#[[" (first args) "]]")) \r\n        [button block-uid]\r\n        [delete-button block-uid]\r\n        ]\r\n    )'}},n={};function t(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={id:e,exports:{}};return r[e](a,a.exports,t),a.exports}t.n=r=>{var n=r&&r.__esModule?()=>r.default:()=>r;return t.d(n,{a:n}),n},t.d=(r,n)=>{for(var e in n)t.o(n,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:n[e]})},t.o=(r,n)=>Object.prototype.hasOwnProperty.call(r,n);var e={};(()=>{t.d(e,{Z:()=>k});var r=t(100),n=t(186),o=t.n(n);function a(r){roamAlphaAPI.deleteBlock({block:{uid:r}})}function i(){let r=new Date(Date.now());return window.roamAlphaAPI.util.dateToPageTitle(r)}function l(r){let n=roamAlphaAPI.util.generateUID();return roamAlphaAPI.data.page.create({page:{title:r,uid:n}}),n}function d(r){return roamAlphaAPI.q(`[:find (pull ?e [:block/uid]) :where [?e :node/title "${r}"]]`)?.[0]?.[0].uid||null}function c(n,t,e,c,s,p,u,g,m){1==n?(function(r,n,t,e,a){let c=d(r)||l(r),s=roamAlphaAPI.util.generateUID(),p=roamAlphaAPI.util.generateUID(),u=roamAlphaAPI.util.generateUID();roamAlphaAPI.createBlock({location:{"parent-uid":c,order:0},block:{string:`${a} [[${i()}]]`,uid:n,open:!0,heading:3}}),roamAlphaAPI.createBlock({location:{"parent-uid":n,order:0},block:{string:`${a} ${t} [[roam/templates]]`,uid:s,open:!0}}),roamAlphaAPI.createBlock({location:{"parent-uid":s,order:0},block:{string:`{{[[roam/render]]:((${e})) tidy}}`,uid:u}}),roamAlphaAPI.createBlock({location:{"parent-uid":n,order:"last"},block:{string:"code",uid:p,open:!1}});let g="```clojure\n "+o()+" ```";roamAlphaAPI.createBlock({location:{"parent-uid":p,order:0},block:{uid:e,string:g}})}("roam/render",t,c,g,m),function(r,n,t,e){let o=d("roam/css")||l("roam/css");roamAlphaAPI.createBlock({location:{"parent-uid":o,order:"last"},block:{string:`${e} [[${i()}]]`,uid:r,open:!1,heading:3}});let a="```css\n "+t.toString()+" ```";roamAlphaAPI.createBlock({location:{"parent-uid":r,order:0},block:{uid:n,string:a}})}(e,u,r.Z,`${m} STYLE`)):0==n&&(function(r,n){let t=`[:find\n        (pull ?node [:block/string :node/title :block/uid])\n      :where\n        (or [?node :block/string ?node-String]\n      [?node :node/title ?node-String])\n        [(clojure.string/includes? ?node-String "${r}")]\n      ]`;window.roamAlphaAPI.q(t).flat().forEach((t=>{const e=t.string.replace(r,n);window.roamAlphaAPI.updateBlock({block:{uid:t.uid,string:e}})}))}(s,p),a(t),a(e))}const s="Tidy TODOs",p="roam-render-tidy-todos-cljs",u="roam-render-tidy-todos-css",g=`{{[[roam/render]]:((${p}))`,m="{{tidy-todos}}",b="roam-render-tidy-todos",f="tidy-todos-css-parent",k={onload:function({extensionAPI:r}){r.settings.panel.create({tabTitle:"Tidy TODOs",settings:[]}),roamAlphaAPI.data.pull("[*]",[":block/uid",b])||c(!0,b,f,"v8",g,m,u,p,s),console.log(`load ${s} plugin`)},onunload:function(){console.log(`unload ${s} plugin`),c(!1,b,f,"v8",g,m,u,p,s)}}})();var o=e.Z;export{o as default};